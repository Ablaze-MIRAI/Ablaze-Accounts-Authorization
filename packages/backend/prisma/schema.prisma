generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_CONNECTION")
}

model User {
  iid          String      @id @default(cuid())
  uid          String      @unique @default(uuid())
  createdAt    DateTime    @default(now())
  screen_name  String
  avatar       String
  account_type AccountType @default(GENERAL)

  // Relationships
  oauth2_code OAuth2AuthorizationCode[]
  refresh_token RefreshToken[]
  idp_email   IdpEmail?
  //idp_discord   IdpDiscord?
}

enum AccountType {
  GENERAL
  MODERATOR
  SUPERUSER
}

model IdpEmail {
  id       String @id @default(cuid())
  email    String @unique
  password String

  // Relationships
  user User   @relation(fields: [iid], references: [iid], onDelete: Cascade)
  iid  String @unique
}

model IdpGitHub {
  id String @id @default(cuid())
}

//model IdpDiscord {
//  id          String @id @default(cuid())
//  diid         String // Discord Internal ID
//  dsid         String // Discord Screen ID
//  screen_name String // Screen Name

// Relationships
//  user User   @relation(fields: [uid], references: [uid], onDelete: Cascade)
//  uid  String @unique
//}

model OAuth2AuthorizationCode {
  id         String   @id @default(cuid())
  code       String @unique
  expiration DateTime
  createdAt  DateTime @default(now())
  client_id  String
  scope      String

  // Relationships
  user User   @relation(fields: [uid], references: [uid], onDelete: Cascade)
  uid  String
}

model RefreshToken {
  id         String   @id @default(cuid())
  token      String   @unique
  expiration DateTime
  updatedAt  DateTime @default(now()) @updatedAt
  createdAt  DateTime @default(now())
  client_id String

  // Relationships
  user User   @relation(fields: [uid], references: [uid], onDelete: Cascade)
  uid  String
}

//model SubRefreshToken {
//  id String @id @default(cuid())
//  token String @unique
//  expiration DateTime
//  updatedAt  DateTime @default(now()) @updatedAt
//  createdAt  DateTime @default(now())
//  name String

// Relationships
//  rt RefreshToken @relation(fields: [rtid], references: [id])
//  rtid String
//}
